{% load staticfiles %}

<div id="map">
</div>

<script src="{% static 'js/leaflet.js' %}" /></script>
<script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.3.0"></script>
<script>

    var map = L.map('map', {
        scrollWheelZoom: false,
        center: {{MAP_CONFIG.center}},
        zoom: {{MAP_CONFIG.zoom}}
    });

    var layer = new L.StamenTileLayer("toner-lite");
    map.addLayer(layer);

    var customOptions =
        {
        'className' : 'custom'
        }

    function onEachFeature(feature, layer) {
        if (feature.properties && feature.properties.popupContent) {
            //layer.bindLabel(feature.properties.popupContent, customOptions);

            var center = layer.getBounds().getCenter();

            if (map){
                layer.layerPopup = L.popup(customOptions)
                                    .setLatLng(center)
                                    .setContent(feature.properties.popupContent);

                layer.on('mouseover', function(e){
                    e.target.setStyle({'fillOpacity': 0.8});
                    e.target.layerPopup.openOn(map);
                });

                layer.on('mouseout', function(e){
                    e.target.setStyle({'fillOpacity': 0.2})
                });

                layer.on('tableover', function(e){
                    e.target.layerPopup.openOn(map);
                    e.target.setStyle({'fillOpacity': 0.8})
                });

                layer.on('tableout', function(e){
                    e.target.setStyle({'fillOpacity': 0.2})
                    map.closePopup(e.target.layerPopup);
                });
            }
        }
    }

    var geojson = L.geoJson({{ map_geojson|safe }}, {
        style: {
                "color": "{{MAP_CONFIG.color}}",
                "weight": 2,
                "opacity": 0.8,
                "fillOpacity": .2
            },
        onEachFeature: onEachFeature
    }).addTo(map);

</script>
